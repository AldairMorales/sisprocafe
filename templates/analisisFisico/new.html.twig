{% extends 'base.html.twig' %}
{% import 'macro/breadcrumb.html.twig' as breadcrumb %}
{% import 'macro/action.html.twig' as action %}

{% set _title = 'Analisis Fisico' %}
{% set _main_title = 'Nuevo' %}
{% set _section =  'analisisFisico_index'%}

{% block _breadcrumb %}
    {{ breadcrumb.show2(_title,_section,'Nuevo') }}
{% endblock %}

{% block _main %}
    {{ include('analisisFisico/_form.html.twig') }}
{% endblock %}

{% block _main_tools %}
    {% include 'crud/_tools_ico.html.twig' %}
{% endblock %}

{% block _body_tools %}
    {% include 'crud/_new_links_ico.html.twig' with {'route_base':'analisisFisico'} %}
{% endblock %}

{% block _body_tools_ico %}
    {% include 'crud/_new_links_tool.html.twig' with {'route_base': 'analisisFisico'}  %}
{% endblock %}

{% block _main_footer %}
    {% include 'crud/_new_links.html.twig' with {'route_base':'analisisFisico'} %}
{% endblock %}

{% block _stylesheets %}
{% endblock %}

{% block _javascripts %}
    <script src="{{ asset('js/select2.js') }}"></script>
    <script>
        jQuery(document).ready(function() {
            Select2();
            //let $acopio = $('#analisis_fisico_acopio_acopio');
            let muestraQuantity = $('#analisis_fisico_muestra');
            let exportableQuantity = $('#analisis_fisico_exportable');
            let segundaQuantity = $('#analisis_fisico_segunda');
            let bolaQuantity = $('#analisis_fisico_bola');
            let cascaraQuantity = $('#analisis_fisico_cascara');

            // temporales
            let exportablePorcentaje = $('#analisis_fisico_exportable_');
            let segundaPorcentaje = $('#analisis_fisico_segunda_');
            let bolaPorcentaje = $('#analisis_fisico_bola_');
            let cascaraPorcentaje = $('#analisis_fisico_cascara_');

            function calculaCascara()
            {
                exportablePorcentaje = $('#analisis_fisico_exportable_');
                segundaPorcentaje = $('#analisis_fisico_segunda_');
                bolaPorcentaje = $('#analisis_fisico_bola_');
                cascaraPorcentaje = $('#analisis_fisico_cascara_');
                let n=Number(exportableQuantity.val())+Number(segundaQuantity.val())+Number(bolaQuantity.val());
                if(n < muestraQuantity.val()){
                    
                    cascara = muestraQuantity.val() - exportableQuantity.val() - segundaQuantity.val() - bolaQuantity.val();
                    cascaraQuantity.val(cascara);
                }else{
                    Notify.danger("Excedio a la Muestra")
                }
                
            }

            function calculaPorcentaje()
            {
                let result = exportableQuantity.val() * 100 / muestraQuantity.val();
                exportablePorcentaje.val(result.toFixed(2)+'%')

                result = segundaQuantity.val()*100  / muestraQuantity.val();
                segundaPorcentaje.val(result.toFixed(2)+'%')

                result = bolaQuantity.val()*100/ muestraQuantity.val();
                bolaPorcentaje.val(result.toFixed(2)+'%')

                result = cascaraQuantity.val()*100/ muestraQuantity.val();
                cascaraPorcentaje.val(result.toFixed(2)+'%')
            }
            $(document).on('change', '#analisis_fisico_muestra', function () {
                    let $this = $(this);
                    muestraQuantity.val($this.val());
                    calculaCascara();
                    calculaPorcentaje();
                });
                $('#analisis_fisico_muestra').trigger('change');

                $(document).on('keyup', '#analisis_fisico_exportable, #analisis_fisico_segunda, #analisis_fisico_bola', function () {
                    calculaCascara();
                    calculaPorcentaje();
                });
        });
    </script>
{% endblock %}